<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>CampusConnect</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="header.css" />
<link rel="stylesheet" href="hbody.css" />
<link rel="stylesheet" href="add.css" />

<style>
#menu div a { text-decoration:none; padding:8px 15px; border-radius:5px; font-weight:600; color:#333; display:inline-block; transition:0.3s; }
#menu div a.active,#menu div a:hover { background-color:#3a7d44; color:white; }

#table-container { margin-top:50px; background:white; padding:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1); border-radius:5px; max-width:fit-content; margin:auto; overflow-x:visible; }

table { border-collapse:collapse; font-family:Arial,sans-serif; margin:0 auto; table-layout:auto; }
table,th,td { border:1px solid #ccc; }
th,td { padding:10px 40px; text-align:center; white-space:nowrap; }
th { background-color:#b5d8a6; font-weight:bold; }

a.action-delete { cursor:pointer; color:#d9534f; font-weight:600; padding:8px; border-radius:5px; display:inline-block; text-decoration:none; transition:all 0.3s ease; }
a.action-delete:hover { background-color:#ffebee; color:#c82333; transform:scale(1.1); }
a.action-edit { cursor:pointer; color:#007bff; font-weight:600; padding:8px; border-radius:5px; display:inline-block; text-decoration:none; transition:all 0.3s ease; }
a.action-edit:hover { background-color:#e0f0ff; color:#0056b3; transform:scale(1.1); }

tr.deleting { background-color:#fff3cd !important; transition:all 0.5s ease; opacity:0.7; }
tr.deleted { opacity:0; transform:scaleY(0); }

.success-toast { position:fixed; top:20px; right:20px; background:#28a745; color:white; padding:15px 20px; border-radius:8px; z-index:10001; box-shadow:0 4px 12px rgba(0,0,0,0.15); animation:toastSlideIn 0.3s ease-out; max-width:350px; }
@keyframes toastSlideIn { from { transform: translateX(100%); opacity:0; } to { transform: translateX(0); opacity:1; } }
</style>
</head>
<body>
<div id="logo-container"><img src="yellowlogo.jpg.png" id="logo" /></div>

<div id="main-content" style="display:none; padding:20px;">
  <div style="position:fixed; width:500px; height:400px;">
    <img src="yellowlogo.jpg" style="width:130px; height:auto; position:fixed; top:10px; left:0;" />
  </div>
  <h2 id="title"><span class="dark-green">Campus</span> <span class="light-green">Connect</span></h2>
  
  <div id="menu">
    <div id="evnt"><a href="add.html?menu=Event">Event</a></div>
    <div id="exm"><a href="add.html?menu=Exam">Exam</a></div>
    <div><a href="add.html?menu=Faculty">Faculty</a></div>
    <div id="fee"><a href="add.html?menu=Fees">Fees</a></div>
  </div>

  <div id="details">
    <div id="name"></div>
    <div id="table-container"></div>
    <div id="btn" style="margin-top:15px;"><a href=""><input type="button" value="ADD" /></a></div>
  </div>
</div>

<script>
window.onload=function(){
  const logoContainer=document.getElementById('logo-container');
  const mainContent=document.getElementById('main-content');

  if(!localStorage.getItem('logoShown')){
    setTimeout(()=>logoContainer.classList.add('shrink'),200);
    setTimeout(()=>{
      logoContainer.style.display='none';
      mainContent.style.display='block';
      void mainContent.offsetWidth;
      mainContent.classList.add('visible');
      localStorage.setItem('logoShown','true');
      initPageContent();
    },1300);
  }else{
    logoContainer.style.display='none';
    mainContent.style.display='block';
    mainContent.classList.add('visible');
    initPageContent();
  }
};

function initPageContent(){
  const param=new URLSearchParams(window.location.search);
  const selectedmenu=param.get("menu")||"Event";

  document.querySelectorAll('#menu div a').forEach(link=>link.classList.toggle('active',link.href.includes(selectedmenu)));

  const nameDiv=document.getElementById("name");
  const tableContainer=document.getElementById("table-container");
  const btn=document.querySelector("#btn a");
  nameDiv.innerHTML=`<h2>${selectedmenu.toUpperCase()}</h2>`;
  btn.href=`${selectedmenu}.html`;

  let endpoint='';
  if(selectedmenu==="Event") endpoint='home_event';
  else if(selectedmenu==="Fees") endpoint='home_fees';
  else if(selectedmenu==="Exam") endpoint='home_exam';
  else if(selectedmenu==="Faculty") endpoint='home_faculty';

  if(endpoint) loadTableData(tableContainer,endpoint);
  else showEmptyTable(selectedmenu,tableContainer);
}

function loadTableData(container,endpoint){
  fetch(endpoint)
    .then(resp=>resp.text())
    .then(html=>{
      container.innerHTML=html;
      attachRowDeleteListeners(container,endpoint);
    })
    .catch(err=>{ console.error("Error:",err); container.innerHTML="<p>Error loading data.</p>"; });
}

function showEmptyTable(menu,container){
  container.innerHTML="";
  const headings={ Event:["ID","Name","Date","Location","Actions"], Exam:["Code","Name","Date","Class","Dept","Actions"], Fees:["ID","Student","Amount","Due","Actions"], Faculty:["ID","Name","Designation","Department","Actions"] };
  const table=document.createElement("table");
  const thead=document.createElement("thead");
  const headerRow=document.createElement("tr");
  (headings[menu]||[]).forEach(text=>{ const th=document.createElement("th"); th.textContent=text; headerRow.appendChild(th); });
  thead.appendChild(headerRow);
  table.appendChild(thead);
  container.appendChild(table);
}

function attachRowDeleteListeners(container,endpoint){
  container.querySelectorAll('a.action-delete').forEach(delLink=>{
    delLink.addEventListener('click',function(e){
      e.preventDefault();
      const row=this.closest('tr');
      const rowId=this.dataset.id;
      if(!confirm("Are you sure you want to delete this row permanently?")) return;

      fetch(endpoint+'?id='+rowId,{method:'DELETE'})
        .then(resp=>{
          if(!resp.ok) throw new Error('Delete failed');
          row.classList.add('deleting');
          setTimeout(()=>{ row.classList.add('deleted'); setTimeout(()=>{ row.remove(); renumberTableRows(container); showSuccessToast('Row deleted successfully!'); },200); },200);
        })
        .catch(err=>alert('Delete failed: '+err));
    });
  });
}

function renumberTableRows(container){
  const table=container.querySelector("table");
  if(table&&table.tBodies.length>0){
    Array.from(table.tBodies[0].rows).forEach((row,index)=>{ if(row.cells[0]) row.cells[0].textContent=index+1; });
  }
}

function showSuccessToast(message){
  const toast=document.createElement('div');
  toast.className='success-toast';
  toast.innerHTML=`<i class="fas fa-check-circle" style="margin-right:8px"></i>${message}`;
  document.body.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}
</script>
</body>
</html>
