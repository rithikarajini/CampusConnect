
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>CampusConnect</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="header.css" />
<link rel="stylesheet" href="hbody.css" />
<link rel="stylesheet" href="container.css" />


</head>
<body>
<div id="logo-container"><img src="clogo.png" id="logo" /></div>

<div id="main-content" style="display:none; padding:20px;">
  <div style="position:fixed; width:500px; height:400px;">
    <img src="clogo.png" style="width:130px; height:auto; position:fixed; top:10px; left:0;" />
  </div>
  <h2 id="title"><span class="dark-green">Campus</span> <span class="light-green">Connect</span></h2>
  
  <div id="menu">
    <div><a href="home.html?menu=Event">Event</a></div>
    <div ><a href="home.html?menu=Exam">Exam</a></div>
    <div><a href="home.html?menu=Faculty">Faculty</a></div>
    <div><a href="home.html?menu=Fees">Fees</a></div>
  </div>

  <div id="details">
    <div id="name"></div>
    <div id="table-container"></div>
    <div id="btn" style="margin-top:15px;"><a href=""><input type="button" value="ADD" /></a></div>
  </div>
</div>

<script>
window.onload=function(){
  const logoContainer=document.getElementById('logo-container');
  const mainContent=document.getElementById('main-content');

  if(!localStorage.getItem('logoShown')){
    setTimeout(()=>logoContainer.classList.add('shrink'),200);
    setTimeout(()=>{
      logoContainer.style.display='none';
      mainContent.style.display='block';
      void mainContent.offsetWidth;
      mainContent.classList.add('visible');
      localStorage.setItem('logoShown','true');
      initPageContent();
    },1300);
  }else{
    logoContainer.style.display='none';
    mainContent.style.display='block';
    mainContent.classList.add('visible');
    initPageContent();
  }
};

function initPageContent(){
  const param=new URLSearchParams(window.location.search);
  const selectedmenu=param.get("menu")||"Event";

  document.querySelectorAll('#menu div a').forEach(link=>link.classList.toggle('active',link.href.includes(selectedmenu)));

  const nameDiv=document.getElementById("name");
  const tableContainer=document.getElementById("table-container");
  const btn=document.querySelector("#btn a");
  nameDiv.innerHTML=`<h2>${selectedmenu.toUpperCase()}</h2>`;
  btn.href=`${selectedmenu}.html`;

  let endpoint='';
  if(selectedmenu==="Event") endpoint='home_event';
  else if(selectedmenu==="Fees") endpoint='home_fees';
  else if(selectedmenu==="Exam") endpoint='home_exam';
  else if(selectedmenu==="Faculty") endpoint='home_faculty';

  if(endpoint) loadTableData(tableContainer,endpoint);
  else showEmptyTable(selectedmenu,tableContainer);
}

function loadTableData(container,endpoint){
  fetch(endpoint)
    .then(resp=>resp.text())
    .then(html=>{
      container.innerHTML=html;
      attachRowDeleteListeners(container,endpoint);
    })
    .catch(err=>{ console.error("Error:",err); container.innerHTML="<p>Error loading data.</p>"; });
}

function showEmptyTable(menu,container){
  container.innerHTML="";
  const headings={
    Event:["ID","Name","Date","Dept","Rulebook","Actions"],
    Exam:["Code","Name","Date","Class","Dept","Actions"],
    Fees:["ID","Student","Amount","Due","Actions"],
    Faculty:["ID","Name","Designation","Department","Actions"]
  };
  const table=document.createElement("table");
  const thead=document.createElement("thead");
  const headerRow=document.createElement("tr");
  (headings[menu]||[]).forEach(text=>{
    const th=document.createElement("th");
    th.textContent=text;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);
  container.appendChild(table);
}

function attachRowDeleteListeners(container, endpoint) {
    container.querySelectorAll('a.action-delete').forEach(delLink => {
        delLink.addEventListener('click', function(e) {
            e.preventDefault();
            const row = this.closest('tr');

            // Determine correct ID depending on table type
            let rowId;
            let paramName;
            switch (endpoint) {
                case "home_event":
                    rowId = this.dataset.event_id;
                    paramName = "event_id";
                    break;
                case "home_fees":
                    rowId = this.dataset.fees_id;
                    paramName = "fees_id";
                    break;
                case "home_faculty":
                    rowId = this.dataset.f_id;
                    paramName = "faculty_id";
                    break;
                default: // home_exam
                    rowId = this.dataset.id;
                    paramName = "id";
            }

            if (!rowId) {
                alert("Invalid ID. Cannot delete.");
                return;
            }

            if (!confirm("Are you sure you want to delete this row permanently?")) return;

            // Create a form to submit the delete POST request
            const form = document.createElement('form');
            form.method = 'post';
            form.action = endpoint;

            const inputId = document.createElement('input');
            inputId.type = 'hidden';
            inputId.name = paramName;
            inputId.value = rowId;
            form.appendChild(inputId);

            const inputAction = document.createElement('input');
            inputAction.type = 'hidden';
            inputAction.name = 'action';
            inputAction.value = 'delete';
            form.appendChild(inputAction);

            document.body.appendChild(form);
            form.submit();
        });
    });
}

function renumberTableRows(container){
  const table=container.querySelector("table");
  if(table&&table.tBodies.length>0){
    Array.from(table.tBodies[0].rows).forEach((row,index)=>{
      if(row.cells[0]) row.cells[0].textContent=index+1;
    });
  }
}

function showSuccessToast(message){
  const toast=document.createElement('div');
  toast.className='success-toast';
  toast.innerHTML=`<i class="fas fa-check-circle" style="margin-right:8px"></i>${message}`;
  document.body.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}
</script>
</body>
</html>
